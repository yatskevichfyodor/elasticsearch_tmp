<!DOCTYPE HTML>

<html>
<head>
    <meta charset="utf-8"/>

    <title >Elasticsearch</title>

    <script src="/webjars/jquery/3.2.0/jquery.min.js" type="text/javascript"></script>

    <style type="text/css" media="screen">

        table{
            border-collapse:collapse;
            border:1px solid #000000;
        }

        table td {
            border:1px solid #000000;
        }
    </style>
</head>

<body>

<h6>enter only 1 word for search</h6>
<input id="searchByAnyField">
<button onclick="search()" style="margin-right:50px">search</button>

<input id="searchByEmailField">
<button onclick="searchByDuplicatedEmails()" style="margin-right:50px">searchByDuplicatedEmails</button>

<input id="searchByAddressField">
<button onclick="searchByDuplicatedAddresses()" style="margin-right:50px">searchByDuplicatedAddresses</button>

<table style="width:100%;border: 1px solid black;" id="responseData">
    <caption>response</caption>
    <tr>
        <th>name</th>
        <th>address</th>
        <th>phone</th>
        <th>email</th>
        <th>site</th>
        <th>section</th>
        <th>industry</th>
    </tr>
</table>

<script>
    function search() {
        var query = $("#searchByAnyField").val();

        $.ajax({
            url: "/search?query=" + query,
            dataType: 'json',
            cache: false,
            timeout: 60000,
            success: function (result) {
                renderResults(result);
            },
            error: function (xhr, ajaxOptions, thrownError) {
                console.log(thrownError);
            }
        });
    }

    function searchByDuplicatedEmails() {
        searchByDuplicatedEmailsStart();
    }

    function searchByDuplicatedAddresses() {
        searchByDuplicatedAddressesStart();
    }

    // $("#searchByEmailField").keypress(function() {
    //     searchByDuplicatedEmailsStart();
    // });

    function searchByDuplicatedEmailsStart() {
        var query = $("#searchByEmailField").val();
        query = query.trim();

        $.ajax({
            url: "/searchCompaniesWithDuplicatedEmails?query=" + query,
            dataType: 'json',
            cache: false,
            timeout: 60000,
            success: function (result) {
                renderResults(result);
            },
            error: function (xhr, ajaxOptions, thrownError) {
                console.log(thrownError);
            }
        });
    }

    function searchByDuplicatedAddressesStart() {
        var query = $("#searchByAddressField").val();
        query = query.trim();

        $.ajax({
            url: "/searchCompaniesWithDuplicatedAddresses?query=" + query,
            dataType: 'json',
            cache: false,
            timeout: 60000,
            success: function (result) {
                renderResults(result);
            },
            error: function (xhr, ajaxOptions, thrownError) {
                console.log(thrownError);
            }
        });
    }

    function renderResults(data) {
        $("#responseData").empty();


        var htmlData = "\n" +
            "    <caption>response</caption>\n" +
            "    <tr>\n" +
            "        <th>name</th>\n" +
            "        <th>address</th>\n" +
            "        <th>phone</th>\n" +
            "        <th>email</th>\n" +
            "        <th>site</th>" +
            "        <th>section</th>\n" +
            "        <th>industry</th>\n" +
            "    </tr>";
        data.forEach( function (row) {
            htmlData += '<tr>';

            htmlData += '<td>' + row['name'] + '</td>';
            htmlData += '<td>' + row['address'] + '</td>';
            htmlData += '<td>' + row['phone'] + '</td>';
            htmlData += '<td>' + row['email'] + '</td>';
            htmlData += '<td>' + row['site'] + '</td>';
            htmlData += '<td>' + row['section'] + '</td>';
            htmlData += '<td>' + row['industry'] + '</td>';

            htmlData += '</tr>';
        });

        $("#responseData").html(htmlData);
    }
</script>

</body>
</html>